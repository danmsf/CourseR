---
title: "Tutorial 1"
author: "GSTAT"
date: "Nov 27, 2016"
output:
  html_document:
    toc: yes
    toc_float: yes
---

![](figures\gstat_logo.jpg)
<!-- <html dir="rtl"> -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
_______


<div class = "notes">

This is my note

</div>

<div dir=rtl>
## למה לעבוד ב R

* זה חינמי
* יש בו את כל מה שיש למתחרים ויותר
* זה דינאמי - אלגורתמים חדשים 
* אפשרויות הצגה מרשימות
* כלי מוביל בעולם ה BIG DATA
* יותר מהיר!!
* יכולת התחברות ל data base קיימים כגון SQL,ORACLE, etc.


______________________  

## הכרת סביבת העבודה

RSTUDIO הוא ממשק המאפשר עבודה נוחה ויעילה עם תוכנת R.

יש ארבע חלוניות ב RSTUDIO ובתוך רוב החלוניות יש מספר טאבים שאפשר לבחור.

ניתן בקלות להגדיל ולהקטין את החלוניות עם העכבר.

ובתוך Tools -> Global options -> Panes

ניתן גם לשנות את מיקומן של החלוניות.

![](figures\rstudio_layout.png)

_______________________________________

### קבלת עזרה

* הקשת ? ולאחריו שם הפקודה
* הקשת ?? ולאחריו שם הפקודה
* חיפוש בחלונית החיפוש

### קיצורי דרך שימושיים

רשימה של קיצורי הדרך נמצאת ב -

Tools - > Keyborad shortcut help

הכי שימושיים

* Ctrl+Enter : הרצת שורת קוד מסומנת
* Alt - : כתיבת אופרטור השמה
* Ctrl+Shift+M : כתיבת אופרטור שרשור
* Ctrl+Shift+C : סימון שורה בתור הערה
* Alt+Shift+K : קיצורי דרך

*** 

## הרצת פקודה

* כתיבה ב CONSOLE והקשת Enter - מבצע מיידית
* כתיבה במסמך R והרצה משם
	+ סימון השורה והרצה Run
	+ סימון שורה ולחיצת קיצור Ctrl+Enter
	+ הרצת ה chunk  הנוכחי
	+ שמירה והרצת כל הקוד ביחד 
* אם מריצים פקודה לפני שהיא הסתיימה R יחכה להמשך הפקודה !!

*** 

## פתיחת פרוייקט חדש

פרוייקט שומר תמונת מצב של סביבת העבודה הפתוח, כך שבפעם הבא שפותחים R כל העבודה שעשינו זמינה ואפשר להמשיך מאיפה שהפסקנו.

אפשר לפתוח פרוייקט חדש בפינה השמאלית למעלה... בואו נעשה את זה עכשיו...

אנחנו נשמור כל אחד את הפרוייקט שלו בתיקייה משלו.

כשנשמור את הפרוייקט ישמר אובייקט מסוג .rdta שמכיל את הנתונים שלנו. בנוסף, כשנפתח שוב את הפרוייקט R יעלה את כל הקבצים שהיו פתוחים לנו בתמונת מצב האחרון.

הפרוייקט בעצם מוגדר על ידי סביבת עבודה (environment) ייחודי לפרוייקט.  

לכל פרוייקט יישמר היסטוריית הפקודות שהיו בשימוש באותו פרוייקט  

***  


### פתיחת script חדש

ב script אפשר לכתוב רשימה של פקודות שמתבצעות רק כשמפעילים אותם ספיציפית (על ידי סימון והרצה) או שאפשר להריץ את כולם ביחד (batch) בשלב מאוחר יותר.

ב RSTUDIO יש כל מיני סוגי script - ים שאפשר לעבודה אתם, כאשר ההבדל בינהים הוא מבחינת תיעוד העבודה וסוג המטלה.

ה Script ים שנעבוד אתם הם:

* script R בסיסי - נשמר כמסמך טקסט עם הסיומת R.  
* rmarkdown - נשמר עם סיומת .rmd ומאפשר שמירת התוצאות במגוון פורמטים
* rnotebook - שדרוג של קובץ markdown המאפשר תצוגה מקדימה של הפלט וייצוא הקוד שייצר אותו

מהשיעור הבא נעבוד עם ה rnotebook - השיטה החדשה ביותר לעבוד עם RSTUDIO

לשיעור הנוכחי בואו נפתח script בסיסי חדש ונשמור אותו בתיקייה שפתחנו בה את הפרוייקט בשם lesson1. 

את התרגילים של השיעור הזה נכתוב בקובץ שיצרנו ונריץ את זה משם...

תזכרו שאפשר להוסיף הערות בסימון `#` בתחילת השורה...


*** 

### תרגיל 1 {.tabset .tabset-fade}
#### Questions

1. קבלו עזרה על הפקודה class . מה זה עושה?

2. קבלו עזרה על הפקודה typeof . מה זה עושה?

2. קבלו עזרה על הפקודה str. מה זה עושה?

***

#### Answers

1. class מחזיר את סוג האובייקט

2. typeof  מחזיר את סוג ערך האובייקט

2. str מראה את מבנה האובייקט

_________________ 

## ערכים ומבנים ב R
### סוגי ערכים ב R

הערכים ב R מתחלקים לסוגים הבאים:

* מספר נומרי (numeric) 
  +  double - למשל 5.22
  +  integer - למשל 5
* טקסט  (character) - למשל "hello".
* משתנה לוגי (logical) - למשל TRUE,FALSE.
* פקטורים (factor) - סוג של integer מיוחד
  + פקטורים רגילים - כן,לא.
  + פקטורים אורדינאליים (ordinal factors) - גבוה,בינוני,נמוך.

_________________  

### 	סוגי מבנים ב R

הערכים האלה נשמרים ביחד במבנים מהסוגים הבאים:

* סקאלר (scalar) - ערך בודד
* וקטורים (vector) - מאגד רשימת ערכים מאותו סוג
* מערכים (list) - מאגד רשימת ערכים מסוגים שונים
* מטריצות (matrix) - וקטורים של ערכים מאותו סוג
* טבלת נתונים (data frame)- וקטורים שונים בצורת טבלה

בהמשך נעבוד בעיקר עם טבלאות ולפעמים וקטורים.   


למעשה data frame הוא סוג מיוחד של מערך (list) עם וקטורים בגדלים שווים ובעלי שמות.

_________________

## כללי Syntax בסיסיים

* R מבדיל בין אותיות קטנות וגדולות
* התו הראשון בשם חייב להיות אות
* שם יכול להכיל: אותיות, מספרים, קוו תחתון, ונקודה
* *תמיד להשתמש בשמות בעלות משמעות*
* תחילת שורה ב `#` מסמנת אותו כהערה לע לביצוע

_______________  

## פקודות בסיסיות

### יצירת משתנה 

מייצרים משתנים בעזרת אופרטור ההשמה `-> `

**(הקיצור הוא Alt -)**

אפשר גם להשתמש בסימן `=` אבל נוהגים לשמור את זה לצרכים אחרים

**פקודת ההשמה דורסת משתנה אם הוא כבר קיים**

### יצירת מערך

מאגדים ערכים ביחד בעזרת הפקודה `()c`


![](figures\assign_operator.png)

______________________

### תרגיל 2  {.tabset .tabset-fade}
#### Questions

1. יצרו את המשתנה x שיכיל את המספר 5

2. בדקו בעזרת class מה יצא לכם

3. יצרו משתנה text1 טקסט (להשתמש בגרשיים)

4. יצרו וקטור numbers1 של המספרים 1 עד 5

5. יצרו וקטור names1 של השמות: dan, ephraim, gstat.

6. בידקו בעזרת str מה יצא לכם.

***  

</div>

#### Answers

1.

```{r a1}
x <- 5
x
```


2. 

```{r a2}
class(x)
```


3.

```{r a3}
x <- " this is a text"
x
```


4.


```{r a4}
numbers1 <- c(1,2,3,4,5)
numbers1
```

או

```{r a4b}
numbers1 <-1:5
numbers1
```


5.

```{r a5}
names1 <- c("dan", "ephraim", "gstat")
names1
```


6. 

```{r a6}
str(names1)
```

<div dir=rtl>
_______________  

##  פעולות
### אופרטורים לוגיים

* הפעלת אופרטור לוגי מחזיר ערך לוגי TRUE או FALSE

![](figures\logical_operator.png)

*** 

### פעולות חשבון

![](figures\math_operator.png)


  
* פעולת חשבון לא חוקי תחזיר ערך NaN
* חלוקת מספר ב 0 תחזיר Inf או -Inf

*** 

### פעולות מיזוג

![](figures\bind_operator.png)

____________

### התניות ומעגלים

צורת הכתיבה של התניה בסיסית היא:

</div>

> if(condition) {do things}

<div dir=rtl>

ואם רוצים לעשות משהו במקרה שהתנאי לא מתקיים:

</div>

> if (condition) {do things} else {do domething else}

<div dir=rtl>

יש גם גרסא מקוצרת של זה:

</div>

> ifelse(condition,do if true, do if false)

<div dir=rtl>


ב R יש את כל הפונקציות המעגליות הרגילות (for, while , repeat) נדגים את הסינטקס של for : 

</div>

> for(i in range) {do something}

<div dir=rtl>

למשל: 

</div>

```{r for_exapmle}


# for example
for(i in 1:5) {print(1:i)}

# for with if example
for(i in 1:5) {
 if(i%%2 == 0){  
  print(i)
  }
}

# for with if else example
for(i in 1:5) {
 if(i%%2 == 0){  
  print('even')
  } else {
  print('odd')
  }
}
```

<div dir=rtl>

* ב R הרבה יותר משתלם ללמוד על משפחת apply או ספריית purrr במקום לעשות פונקציות מעגליות... *

על אטרציות על ווקטורים נלמד בשיעור האחרון.

____________ 

### ערכים חסרים

* ערך חסר מסומן כ NA
* רוב הפונקציות מאפשרות השמטת ערך חסר מהחישוב למשל:
	+ mean(data, na.rm = TRUE)
* אם לא עושים את זה - לרוב הפונקציות מקבלים הודעת שגיאה (ניתן לשלוט על זה בהגדרות מוקדמות)
	
_____________ 

## בחירת נתונים מאובייקטים

בכל סוגי המבנים ניתן לשלוף נתונים באחד מ 3 דרכים:

* בחירת נתונים לפי מקום
* בחירת נתונים לפי תנאי (ערך לוגי)
* בחירת נתונים לפי שם

______________________




## בחירת נתונים בווקטורים ומטריצות

### בחירת נתונים לפי מקום

בחירת נתונים בווקטורים ומטריצות באופן הבא:

	 [עמודה,שורה]אוביקט

* אם משמיטים מספר שורה או עמודה כל השורות או עמודות מוחזרות
* ניתן לבחור בתווך שורות או עמודות בעזרת `:` 
* או בשורות או עמודות ספיציפיות בעזרת `()c` 

![](figures\vector_assign.png)



בהקשר של מערכים (list) יש הבדל משמעותי עם משתמשים ב `[` או ב `[[` לשלוף את הנתונים.

_______

### החלפת נתונים לפי מקום 

באותו שיטה ניתן להחליף ערכים:  
	
![](figures\vector_input.png)

_______

### בחירת נתונים לפי תנאי

* להחזרת וקטור/ מטריצות לפי תנאי : נשים את התנאי בתוך סוגריים מרובעים:
</div>
```{r vector_subscript}

# Create Vector
x <- c(1,2,3,4,5,6,7,8,9,10)

# Subscript
x[x>4]

```
<div dir=rtl>
* החלפת ערך באותה צורה
</div>
```{r vector_assign}

x[x==6] <- 999

x

```

_________ 
<div dir=rtl>
## מחיקות

* מחיקת שורה תעשה/עמודה על ידי הצבת NULL במקום השורה/עמודה
* מחיקת ערך בטבלה בעזרת הצבת NA
* מחיקת משתנה על ידי הפקודה rm
* מחיקת כמה משתנים בעזרת rm עם שמות המשתנים מופרדים בפסיק


___________ 

## בחירת נתונים לפי שם

גם במטריצות ווקטורים ניתן לתת שמות לעמודות ולשורות.

עם זאת האובייקט הנפוץ ביותר הוא טבלה data.frame המקשר בין וקטורים שונים.

ה syntax לשלוף נתון מתוך טבלה היא:

		[שורה]עמודה$טבלה

* השמטת החלק של השורה תחזיר את כל העמודה.

בהמשך נשתמש בסוג מסוים של data.frame הנקרא df_tbl המאפשר עבודה נוחה וצפויה יותר עם טבלאות. אבל גם אז נוכל להשתמש ב syntax הזה בשביל לגשת לנתונים בטבלה.

למשל: 

</div>

```{r data_frame_ex1}
str(iris)

var1 <- iris$Species

table(var1)

rm(var1)
```


<div dir=rtl>

### שאילתא מורכבת בסיסית  

#### בשיטה הבסיסית  

לבחירת שאילתא על טבלה, מכניסים את התנאי למקום הראשון ואת העמודה שרוצים בחזרה במקום השני.
לדוגמא:  

</div>


> iris[iris$Sepal.Length>5,"Species"]

<div dir=rtl>


אם רוצים את כל העמודות אז לא צריך לציין שום דבר במקום השני

</div>


> iris[iris$Sepal.Length>5,]


<div dir=rtl>


אם רוצים עמודות ספציפיות מאגדים אותם בעזרת האופרטור c:

</div>


>  iris[iris$Sepal.Length>5,c("Species", "Sepal.Length")]

<div dir=rtl>


**השמת ערכים נעשת באותו שיטה.**
  

#### בעזרת subset


לחלופין ניתן להשתמש בפונקציה subset שמקלה על הכתיבה:

בעזרת הפונקציה `subset` ניתן לבצע שאילתא המשלבת בין בחירת נתונים לפי תנאי ובחירת עמודות רלוונטטיות.

מבנה הפקודה היא:

</div>

_______


>	subset(עמודות לשליפה, תנאי לסינון, טבלת המקור)

<div dir=rtl>

למשל:

</div>


```{r subset_example1}
str(iris)

y <- subset(iris, Species=="setosa", c("Sepal.Length","Sepal.Width"))

str(y)

rm(y)
```


<div dir=rtl>

______ 

## פונקציות שימושיות

__________

### פקודות סטטיסטיות

* summary -- סיכום סטטיסטי למשתנה 
* table -- טבלת התפלגות
* n -- ספירה
* mean -- ממוצע
* max -- מקסימום
* min -- מינימום
* median -- חציון
* sd -- סטיית תקן
* rnorm -- דגום n תצפיות מהתפלגות נורמלית

___________

### פקודות לשינוי סוג משתנה

* factor -- הגדרת משתנה כפקטור
*  asDate 
-- הגדרת תאריך בפורמטים שונים
* as.data.frame -- הפוך וקטור או מטריצה לטבלה
* as.numeric -- הפוך וקטור לנומרי


____________

### פקודות אחרות

* rm -- מחיקת משתנה
* dim -- מחזיר את מימדי האובייקט
* nrow -- מספר השורות באובייקט
* length -- מספר הרשומות באובייקט
* head --  ערכים הראשונים

_____________ 


### פקודות לערכים חסרים

* na.omit  -- מחזיר את x ללא שורות שבהן באחד העמודות ערך חסר.
* anyNA  -- מחזיר סקאלר TRUE/FALSE אם אחד מערכי x הוא NA.
* is.na      -- מחזיר וקטור לוגי TRUE/FALSE  עבור ערכי x שהם NA.
* is.nan      -- מחזיר וקטור לוגי TRUE/FALSE  עבור ערכי x שהם NaN.

_________  

### פקודות גרפיות

* hist -- היסטוגרמה
* boxplot -- גרף box plot
* plot -- פקודה גנרית לכל מיני גרפים

__________


### תרגיל 3  {.tabset .tabset-fade}
#### Questions
1. תייצרו וקטור של הספרות 1 עד 5, ועוד אחד של הספרות 6 עד 10. תאגדו אותם למטריצה של 2 עמודות בשם X.
2. תציבו את הערך החסר NA במקום השורה השלישית העמודה השניה.
3. תחשוב סטטיסטיקה בסיסית למטריצה.
4. תחברו למטריצה עוד עמודה של האותיות a עד e .
5. איזה סוג אובייקט יש לכם עכשיו?
6. המירו את האובייקט ל data.frame בעזרת as.data.frame
7. יצר משתנה חדש הכולל 10,000 תצפיות מהתפלגות נורמלית בעזרת rnorm
8. צייר היסטוגרמה של המשתנה הזה
9. מחקו את כל מה שעשיתם :) בעזרת rm

</div>
#### Answers
1.
```{r a3_1}
x <- c(1,2,3,4,5)
y <- c(6,7,8,9,10)

m1 <- cbind(x,y)

m1

```

2.
```{r a3_2}
m1[3,2] <- NA

m1

```

3.
```{r a3_3}

# this works
summary(m1)

# this doesnt
mean(m1)

# this does
mean(m1, na.rm = TRUE)

```

4.
```{r 3_4}
m1 <- cbind(m1,c("a","b","a","b","a"))

```

5.
```{r 3_5}
class(m1)

str(m1)
```

6.
```{r 3_6}
m1 <- as.data.frame(m1)
class(m1)
str(m1)
```


7.
```{r 3_7}
new_var <- rnorm(10000)
```

8.
```{r 3_8}
hist(new_var)
```

9.
```{r remove}
rm(m1,names1,new_var,numbers1,x,y)
```


_____ 
__________


<div dir=rtl>


### תרגיל 4  {.tabset .tabset-fade}
#### Questions

1. קראו את הנתונים מ `iris` לתוך אובייקט בשם `iris_data`. התבוננו במבנה הנתונים שיצרתם. מה הרמות הייחודיות של העמודה `Species`?
2. מה הערך הממוצע של המשתנה  `Sepal.Length` ?
3. לאיזה סוג פרחים `Species` יש ערך `Sepal.Length` גדול מ 5 ?
4. יצרו גרף של  `Sepal.Length` מול `Sepal.Width`
5. יצרו משתנה `Grp_Length` שמבקל את הערך 1 עבור `Sepal.Length` גדול מ 5 ו 0 אחרת
6. הציגו  טבלת התפלגות בין המשתנים `Grp_Length` ו `Species`
7. החליפו את הערך של `Sepal.Length` לערך חסר במקרים בהן `Grp_Length` שווה ל 0. חישבו ממוצע על המשתנה החדש
8. מחקו את העמודה `Grp_Length`
9. נסו לחבר את מערך המספרים מ 1 עד 5 למערך המספרים 1 עד 2. מה R עושה במקרה כזה?
10. השתמשו בפקודה ls() על מנת לקבל את שמות המשתנים הקיימים. תנקו את אזור העבודה שלכם מנתונים.

</div>
#### Answers
1.
```{r a4_1}
iris_data <- iris

str(iris_data)

levels(iris_data$Species)
```

2.
```{r a4_2}
summary(iris_data)

```

3.
```{r a4_3}

# Option 1

table(subset(iris_data, Sepal.Length>5, c(Species)))

# Option 2
# Notice the comma in the brackets what does it do
table(iris_data[iris_data$Sepal.Length>5,"Species"])

# This does not give the expected result!!
table(iris_data["Sepal.Length">5,"Species"])

# Option 3
table(iris_data[iris_data$Sepal.Length>5,]$Species)

```

4.
```{r a4_4}

plot(iris_data$Sepal.Length, iris_data$Sepal.Width)

```

5.
```{r 4_5}

iris_data$Grp_Length <- 0
iris_data$Grp_Length[iris_data$Sepal.Length>=5] <- 1

# Lets look at a summary to make sure we are right

summary(iris_data[iris_data$Grp_Length == 1,"Sepal.Length"])
summary(iris_data[iris_data$Grp_Length == 0,"Sepal.Length"])

```

6.
```{r a4_6}

table(iris_data$Species, iris_data$Grp_Length)

```


7.
```{r a4_7}

iris_data$Sepal.Length[iris_data$Grp_Length == 0] <- NA

# Unpredictable NA actions

# This looks good
summary(iris_data$Sepal.Length)


# This doesnt return the expected answer
mean(iris_data$Sepal.Length)

# This does
mean(iris_data$Sepal.Length, na.rm = TRUE)


```
8.

```{r 4_8}

# Option 1
iris_data$Grp_Length <- NULL

# Option 2 
iris_data <- iris_data[,-6]

```

9.
```{r a4_9}

1:5

1:2

1:5 + 1:2

# See whats going on - recycling...

```

10.
```{r a4_10}

# get a list of whats in the current environment

ls()

# this erases everything in our environment

rm(list = ls(.GlobalEnv))
```


_____ 
